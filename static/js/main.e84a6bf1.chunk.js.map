{"version":3,"sources":["logo.svg","components/ChartBars.jsx","components/ChartLine.jsx","utils/useSmoothedSeries.js","utils/toThaiDate.js","components/Button.jsx","components/ChartBlock.jsx","components/Chart.jsx","App.jsx","reportWebVitals.ts","index.tsx"],"names":["ChartBars","processedData","scaleX","scaleY","color","gutter","gRef","useRef","barWidth","useMemo","Math","max","abs","range","length","useEffect","current","d3","selectAll","data","enter","append","classed","d","attr","Date","date","value","domain","class","ref","ChartLine","nMark","markOffset","props","g","console","log","select","datum","x","y","markPos","stroke-linejoin","transform","x1","y1","x2","y2","stroke","textAnchor","dominantBaseline","style","fill","fontSize","fontWeight","useSimplifiedSeries","yFunction","map","i","toThaiDate","showDayOfWeek","dt","DateTime","fromISO","dow","weekday","Number","isNaN","get","Button","styled","button","isFullWidth","css","mb","ChartBlock","div","datesRange","padding","breakPoint","latestDate","firstDate","accumulated","latestValueOutskirt","latestValue","boxHeight","boxWidth","rawSeries","smoothedSeries","fillPanel","tickCount","label","notes","showDisclaimer","boxPadding","textBoxWidth","disclaimerOffset","adjustedScaleY","bottom","top","call","tickValues","tickFormat","fromJSDate","toISODate","tickSize","tickPadding","ticks","left","width","height","rx","toLocaleString","opacity","right","ChartContainer","Chart","svgRef","pad","chartPadding","useDimensions","onResize","observe","unobserve","entry","lastestDay","w","h","lastEntry","dayNum","iso","dateStr","dayColor","weekdayStr","weekdayNum","bangkokNewCases","bangkok","new_cases","smoothedNewCases","new_cases_7day_average","bangkokNewDeaths","thailand","NewConfirmed","new_death","smoothedNewDeaths","new_deaths_7day_average","paddedWidth","paddedHeight","scaleYDeaths","deathBoxHeight","id","className","viewBox","backgroundColor","accumulated_cases","new_cases_outskirt","topOffset","accumulated_death","new_death_outskirt","textAlign","margin","marginTop","display","justifyContent","marginBottom","data-href","data-layout","data-size","marginRight","target","href","rel","data-url","data-via","data-dnt","data-show-count","marginLeft","data-lang","data-type","data-ver","data-color","data-count","as","onClick","elm","document","getElementById","offsetHeight","offsetWidth","domtoimage","toPng","then","dataUrl","link","createElement","download","click","catch","err","error","flexGrow","flexBasis","lineHeight","Container","App","useState","Data","nationalData","bangkokData","setBangkokData","now","minus","months","startOf","startDate","setStartDate","endDate","setEndDate","dates","push","plus","days","axios","res","Papa","parse","header","dynamicTyping","filteredNational","filteredGSheets","combined","filter","substr","showTweetText","URLSearchParams","window","location","search","border","borderRadius","navigator","clipboard","writeText","innerText","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.e84a6bf1.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/logo.6ce24c58.svg\";","import React, { useState, useEffect, useMemo, useRef } from \"react\";\nimport { DateTime } from 'luxon';\nimport Papa from 'papaparse';\nimport * as d3 from 'd3';\nimport useDimensions from \"react-cool-dimensions\";\nimport styled from 'styled-components';\n\nconst ChartBars = ({\n  processedData = [],\n  scaleX,\n  scaleY,\n  color,\n  gutter = 2,\n}) => {\n\n  const gRef = useRef(null);\n\n  const barWidth = useMemo(() => {\n    return Math.max(\n      Math.abs(scaleX.range()[1] - scaleX.range()[0]) / (processedData?.length || 1) - gutter,\n      1)\n  }, [gutter, processedData, scaleX, scaleY]);\n\n  useEffect(() => {\n    if (!gRef.current)\n      return;\n\n    var g = d3.select(gRef.current);\n\n    var barGroup = g.selectAll(\"g.bar\")\n      .data(processedData)\n      .enter()\n      .append(\"g\")\n      .classed(\"bar\", true);\n\n    barGroup.selectAll(\"rect.b\")\n      .data(d => {\n        // console.log(d)\n        return [d];\n      })\n      .enter()\n      .append(\"rect\")\n      .classed(\"b\", true)\n      .attr(\"x\", d => scaleX(new Date(d.date)) - barWidth)\n      .attr(\"y\", d => scaleY(d.value))\n      .attr(\"width\", barWidth)\n      .attr(\"height\", d => scaleY(scaleY.domain()[1] - d.value))\n      .attr(\"fill\", color);\n\n  }, [processedData, scaleX, scaleY]);\n\n  return <>\n    <g class=\"bars\" ref={gRef}></g>\n  </>;\n}\n\nexport default ChartBars;\n","import React, { useState, useEffect, useMemo, useRef } from \"react\";\nimport { DateTime } from 'luxon';\nimport Papa from 'papaparse';\nimport * as d3 from 'd3';\nimport useDimensions from \"react-cool-dimensions\";\nimport styled from 'styled-components';\n\nconst ChartLine = ({\n  processedData = [],\n  scaleX,\n  scaleY,\n  gutter = 2,\n  color = \"#000\",\n  nMark = 7,\n  markOffset = 24,\n  ...props\n}) => {\n\n  const gRef = useRef(null);\n\n  useEffect(() => {\n    if (!gRef.current)\n      return;\n\n    var g = d3.select(gRef.current);\n\n    console.log(processedData);\n\n    g.select(\"path\")\n      .datum(processedData)\n      .attr(\"fill\", \"none\")\n      .attr(\"stroke\", color)\n      .attr(\"stroke-width\", 3)\n      .attr(\"d\", d3.line()\n        // .curve(d3.curveCatmullRom)\n        .x(d => scaleX(new Date(d.date)))\n        .y(d => scaleY(d.value))\n      )\n\n  }, [processedData]);\n\n\n  const markPos = useMemo(() => {\n    if (processedData.length <= 0) return { x: 0, y: 0 };\n\n    console.log('markPos',\n      processedData,\n      scaleX(new Date(processedData?.[nMark]?.date)),\n      scaleY(processedData?.[nMark]?.value))\n    // const i = Math.min(processedData.length / 2);\n\n    return {\n      x: scaleX(new Date(processedData?.[nMark]?.date)),\n      y: scaleY(processedData?.[nMark]?.value)\n    }\n  }, [processedData, nMark]);\n\n  return <>\n    <g class=\"line\" ref={gRef} {...props}>\n      <path stroke-linejoin=\"round\" />\n      <g class=\"average-mark\" transform={`translate(${markPos.x},${markPos.y})`}>\n        <line x1={0} y1={0} x2={0} y2={-markOffset} stroke=\"#fff\" />\n        <text textAnchor=\"middle\" dominantBaseline=\"baseline\" y={-markOffset-4} style={{ fill: '#fff' }} fontSize={12} fontWeight=\"400\">ค่าเฉลี่ย 7 วัน</text>\n      </g>\n    </g>\n  </>;\n}\n\nexport default ChartLine;\n","import React, { useMemo } from \"react\";\r\n\r\nexport const useSimplifiedSeries = (data, yFunction) => {\r\n  return useMemo(() => {\r\n    return data.map((x, i) => {\r\n      return {\r\n        date: x.date,\r\n        value: yFunction(x),\r\n      };\r\n    });\r\n  }, [data, yFunction]);\r\n};\r\n\r\nexport const useSmoothedSeries = (data, yFunction, n = 7) => {\r\n  console.log(data);\r\n  return useMemo(() => {\r\n    return data\r\n      .map((x, i) => {\r\n        return x && typeof yFunction(x) === \"number\"\r\n          ? {\r\n              date: x.date,\r\n              value:\r\n                data\r\n                  .map(yFunction)\r\n                  .filter((d, j) => i - n < j && j <= i)\r\n                  .reduce((a, b) => a + b, 0) / (Math.min(n, i) || 1),\r\n            }\r\n          : undefined;\r\n      })\r\n      .filter((x) => x !== undefined);\r\n  }, [data, yFunction, n]);\r\n};\r\n","import { DateTime } from \"luxon\";\r\n\r\nexport const toThaiDate = (date, showDayOfWeek) => {\r\n  let dt = date;\r\n  if (typeof date === \"string\") dt = DateTime.fromISO(date);\r\n\r\n  const monthString = [\r\n    \"\",\r\n    \"ม.ค.\",\r\n    \"ก.พ.\",\r\n    \"มี.ค.\",\r\n    \"เม.ย.\",\r\n    \"พ.ค.\",\r\n    \"มิ.ย.\",\r\n    \"ก.ค.\",\r\n    \"ส.ค.\",\r\n    \"ก.ย.\",\r\n    \"ต.ค.\",\r\n    \"พ.ย.\",\r\n    \"ธ.ค. \",\r\n  ];\r\n\r\n  const weekDayAbbr = [\"อา.\", \"จ.\", \"อ.\", \"พ.\", \"พฤ.\", \"ศ.\", \"ส.\", \"อา.\"];\r\n\r\n  const dow = showDayOfWeek ? `${weekDayAbbr[dt?.weekday ?? 0]} ` : \" \";\r\n\r\n  return dt && !Number.isNaN(dt.get(\"day\"))\r\n    ? `${dow}${dt.get(\"day\")} ${monthString[dt.get(\"month\")]} ${\r\n        (dt.get(\"year\") + 543) % 100\r\n      }`\r\n    : \"\";\r\n};\r\n","import React from 'react';\r\nimport styled, { css } from 'styled-components';\r\n\r\nconst Button = styled.button`\r\n    color: #7F353E;\r\n    border: 1px #7F353E solid;\r\n    /* background-color: #C33646;\r\n    color: #fff !important; */\r\n    /* border: none; */\r\n    padding: 6px 12px;\r\n    border-radius: 8px;\r\n    font-family: 'Mitr', sans-serif;\r\n    font-size: 1rem;\r\n    text-decoration: none;\r\n    margin: 0;\r\n    display: inline-block;\r\n    \r\n    ${props => props.isFullWidth && css`\r\n        display: block;\r\n        width: auto;\r\n    `}\r\n\r\n    ${props => props.mb && css`\r\n        margin-bottom: 16px;\r\n    `}\r\n\r\n    &:hover {\r\n        background-color: #7F353E;\r\n        color: #fff !important;\r\n        border: none;\r\n    }\r\n`;\r\n\r\nexport default Button;","import React, { useState, useEffect, useMemo, useRef } from \"react\";\r\nimport { DateTime } from 'luxon';\r\nimport Papa from 'papaparse';\r\nimport * as d3 from 'd3';\r\nimport useDimensions from \"react-cool-dimensions\";\r\nimport styled from 'styled-components';\r\n\r\nimport ChartBars from './ChartBars';\r\nimport ChartLine from './ChartLine';\r\nimport { useSimplifiedSeries, useSmoothedSeries } from '../utils/useSmoothedSeries';\r\nimport { toThaiDate } from '../utils/toThaiDate';\r\nimport domtoimage from 'dom-to-image';\r\nimport Button from './Button';\r\n\r\n\r\nconst ChartContainer = styled.div`\r\n  /* padding: 30px; */\r\n  width: 100%;\r\n  /* margin-top: 10px; */\r\n  /* height: 50vh; */\r\n  flex: 1;\r\n  position: relative;\r\n  transition: all 0.2s;\r\n\r\n  text {\r\n    font-family: 'Mitr', sans-serif;\r\n  }\r\n\r\n  .axis line, .axis path {\r\n    stroke: white;\r\n  }\r\n\r\n  .axis text {\r\n    fill: white;\r\n    font-size: 12px;\r\n    font-family: 'Mitr', sans-serif;\r\n  }\r\n\r\n  text {\r\n    fill: #7F353E;\r\n  }\r\n\r\n  text.text-white {\r\n    fill: #fff;\r\n  }\r\n\r\n  .y-axis-deaths {\r\n    opacity: 0.3;\r\n\r\n    path {\r\n      opacity: 0;\r\n    }\r\n  }\r\n\r\n  .y-axis {\r\n    opacity: 0.4;\r\n\r\n    path {\r\n      opacity: 0;\r\n    }\r\n  }\r\n\r\n  .shadow {\r\n    filter: drop-shadow( 0px 8px 8px rgba(0, 0, 0, .2));\r\n    /* Similar syntax to box-shadow */\r\n  }\r\n\r\n  .x-axis text { opacity: 0; }\r\n  .x-axis-deaths text { opacity: 0; }\r\n`;\r\n\r\nconst SvgContainer = styled.div`\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n\r\n  font-family: 'Mitr', sans-serif;\r\n\r\n  \r\n`;\r\n\r\nconst ChartBlock = ({\r\n  processedData,\r\n  datesRange,\r\n  padding,\r\n  breakPoint = 0.7,\r\n  x,\r\n  y,\r\n  latestDate,\r\n  firstDate,\r\n  accumulated,\r\n  latestValueOutskirt,\r\n  latestValue,\r\n  boxHeight,\r\n  boxWidth,\r\n  scaleX,\r\n  scaleY,\r\n  rawSeries,\r\n  smoothedSeries,\r\n  fill = '#333031',\r\n  fillPanel = '#fff1',\r\n  tickCount = 5,\r\n  label = \"\",\r\n  notes = '',\r\n  showDisclaimer = false\r\n}) => {\r\n\r\n  const gRef = useRef(null);\r\n  const boxPadding = 16;\r\n  const textBoxWidth = 200;\r\n  const disclaimerOffset = useMemo(() => showDisclaimer ? 28 : 0, [showDisclaimer]);\r\n\r\n  const adjustedScaleY = useMemo(() => {\r\n    const domain = scaleY.domain();\r\n    const range = scaleY.range();\r\n    range[0] = range[0] - disclaimerOffset;\r\n    return d3.scaleLinear().domain(domain).range(range);\r\n  }, [scaleY, disclaimerOffset]);\r\n\r\n  useEffect(() => {\r\n    if (!gRef.current)\r\n      return;\r\n\r\n    var g = d3.select(gRef.current)\r\n\r\n    g.select(\"g.x-axis\")\r\n      // .attr(\"transform\", `translate(0,${paddedHeight * (1 - breakPoint)})`)\r\n      .attr(\"transform\", `translate(0,${boxHeight - 2 * boxPadding - padding.bottom - padding.top - disclaimerOffset })`)\r\n      .call(d3.axisBottom(scaleX)\r\n        .tickValues(scaleX.domain())\r\n        .tickFormat(d => DateTime.fromJSDate(d).toISODate())\r\n        .tickSize(0)\r\n        .tickPadding(8)\r\n      );\r\n\r\n    g.select(\"g.y-axis\")\r\n      .call(d3.axisLeft(adjustedScaleY)\r\n        .ticks(tickCount)\r\n        .tickPadding(8)\r\n        .tickSize(-(boxWidth - textBoxWidth - boxPadding * 2 - padding.left))\r\n      );\r\n  }, [gRef, scaleX, adjustedScaleY, padding, boxHeight, disclaimerOffset, tickCount, boxWidth]);\r\n\r\n  return (\r\n    <g ref={gRef} transform={`translate(${x},${y})`}>\r\n      <rect width={boxWidth} height={boxHeight} rx={16} fill={fill} class=\"shadow\" />\r\n      <g transform={`translate(${0},${0})`}>\r\n        <rect width={textBoxWidth} height={boxHeight} rx={16} fill={fillPanel} />\r\n        <g transform={`translate(${textBoxWidth / 2},${boxHeight / 2 - 6 - (notes ? 8 : 0)})`}>\r\n          <text y={-44} dominantBaseline=\"middle\" textAnchor=\"middle\" fontWeight=\"400\" fontSize={24} class=\"text-white\">{label}</text>\r\n          <text y={0} dominantBaseline=\"middle\" textAnchor=\"middle\" fontWeight=\"600\" fontSize={48} class=\"text-white\">\r\n            +{latestValue?.toLocaleString?.()}\r\n          </text>\r\n          {((latestValueOutskirt ?? null) !== null) &&\r\n            <text y={36} dominantBaseline=\"middle\" textAnchor=\"middle\" fontWeight=\"400\" fontSize={20} class=\"text-white\">\r\n              ปริมณฑล +{latestValueOutskirt?.toLocaleString?.()}\r\n            </text>\r\n          }\r\n          {notes &&\r\n            <text y={60} dominantBaseline=\"middle\" textAnchor=\"middle\" fontWeight=\"300\" fontSize={16} class=\"text-white\" style={{ opacity: 0.5 }}>\r\n              *{notes}\r\n            </text>\r\n          }\r\n        </g>\r\n        <text x={textBoxWidth / 2} y={boxHeight - boxPadding} dominantBaseline=\"baseline\" textAnchor=\"middle\" fontWeight=\"400\" fontSize={20} class=\"text-white\" style={{ opacity: 0.5 }}>\r\n          สะสม {accumulated?.toLocaleString?.()} ราย\r\n        </text>\r\n      </g>\r\n      {/* AXIS DATE TICKS */}\r\n\r\n      <g\r\n        class=\"chart\"\r\n        transform={`translate(${textBoxWidth},${0})`}\r\n      >\r\n        <g transform={`translate(${boxPadding + padding.left},${boxPadding + padding.top})`}>\r\n          <g class=\"x-axis axis\"></g>\r\n          <g class=\"y-axis axis\"></g>\r\n          <ChartBars\r\n            processedData={rawSeries}\r\n            color=\"#fff6\"\r\n            scaleX={scaleX}\r\n            scaleY={adjustedScaleY}\r\n          />\r\n          <ChartLine\r\n            processedData={smoothedSeries}\r\n            color=\"#fff\"\r\n            scaleX={scaleX}\r\n            scaleY={adjustedScaleY}\r\n          />\r\n        </g>\r\n        <text\r\n          x={boxPadding + padding.left}\r\n          y={boxHeight - boxPadding - padding.bottom - disclaimerOffset  + 6}\r\n          dominantBaseline=\"hanging\"\r\n          textAnchor=\"start\"\r\n          fontWeight=\"400\"\r\n          fontSize={12}\r\n          class=\"text-white\">\r\n          {toThaiDate(DateTime.fromISO(firstDate))}\r\n        </text>\r\n        <text\r\n          x={boxWidth - textBoxWidth - boxPadding - padding.right}\r\n          y={boxHeight - boxPadding - padding.bottom - disclaimerOffset + 6}\r\n          dominantBaseline=\"hanging\"\r\n          textAnchor=\"end\"\r\n          fontWeight=\"400\"\r\n          fontSize={12}\r\n          class=\"text-white\">\r\n          {toThaiDate(DateTime.fromISO(latestDate))}\r\n        </text>\r\n        <text y={boxPadding} x={boxWidth - textBoxWidth - boxPadding} fontSize={12} dominantBaseline=\"hanging\" textAnchor=\"end\" class=\"text-white\" style={{ opacity: 0.5 }}>\r\n          ข้อมูลย้อนหลัง 2 เดือน\r\n        </text>\r\n        {showDisclaimer && <>\r\n          <text y={boxHeight - padding.bottom - 12} x={boxWidth - textBoxWidth - boxPadding} fontSize={12} fontWeight=\"normal\" dominantBaseline=\"baseline\" textAnchor=\"end\" class=\"text-white\">\r\n            *ยอดผู้ติดเชื้อนี้น่าจะต่ำกว่าจำนวนผู้ติดเชื้อจริง\r\n          </text>\r\n          <text y={boxHeight - padding.bottom} x={boxWidth - textBoxWidth - boxPadding} fontSize={12} fontWeight=\"normal\" dominantBaseline=\"baseline\" textAnchor=\"end\" class=\"text-white\">\r\n            เนื่องจากการตรวจลดลงเพราะเตียงรับผู้ป่วยไม่เพียงพอ\r\n          </text>\r\n        </>}\r\n      </g>\r\n    </g>\r\n  );\r\n}\r\n\r\nexport default ChartBlock;\r\n","import React, { useState, useEffect, useMemo, useRef } from \"react\";\nimport { DateTime } from 'luxon';\nimport Papa from 'papaparse';\nimport * as d3 from 'd3';\nimport useDimensions from \"react-cool-dimensions\";\nimport styled from 'styled-components';\n\nimport ChartBars from './ChartBars';\nimport ChartLine from './ChartLine';\nimport { useSimplifiedSeries, useSmoothedSeries } from '../utils/useSmoothedSeries';\nimport { toThaiDate } from '../utils/toThaiDate';\nimport domtoimage from 'dom-to-image';\nimport Button from './Button';\nimport ChartBlock from \"./ChartBlock\";\n\n\nconst ChartContainer = styled.div`\n  /* padding: 30px; */\n  width: 100%;\n  /* margin-top: 10px; */\n  /* height: 50vh; */\n  flex: 1;\n  position: relative;\n  transition: all 0.2s;\n\n  text {\n    font-family: 'Mitr', sans-serif;\n  }\n\n  .axis line, .axis path {\n    stroke: white;\n  }\n\n  .axis text {\n    fill: white;\n    font-size: 12px;\n    font-family: 'Mitr', sans-serif;\n  }\n\n  text {\n    fill: #7F353E;\n  }\n\n  text.text-white {\n    fill: #fff;\n  }\n\n  .y-axis-deaths {\n    opacity: 0.3;\n\n    path {\n      opacity: 0;\n    }\n  }\n\n  .y-axis {\n    opacity: 0.4;\n\n    path {\n      opacity: 0;\n    }\n  }\n\n  .shadow {\n    filter: drop-shadow( 0px 8px 8px rgba(0, 0, 0, .2));\n    /* Similar syntax to box-shadow */\n  }\n\n  .x-axis text { opacity: 0; }\n  .x-axis-deaths text { opacity: 0; }\n`;\n\nconst SvgContainer = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n\n  font-family: 'Mitr', sans-serif;\n\n  \n`;\n\nconst Chart = ({\n  processedData,\n  datesRange,\n  padding = { top: 18, right: 0, bottom: 12, left: 40 },\n  breakPoint = 0.7\n}) => {\n\n  const svgRef = useRef(null);\n  const canvasRef = useRef(null);\n  const imageLinkRef = useRef(null);\n\n  const width = 640;\n  const height = 640;\n  const pad = 32;\n  const gutter = 24;\n  const boxHeight = 240;\n  const deathBoxHeight = 160;\n  const boxWidth = width - pad * 2;\n  const boxPadding = 16;\n  const textBoxWidth = 200;\n  const topOffset = 120;\n  const chartPadding = padding;\n\n  const { observe, unobserve, w, h, entry } = useDimensions({\n    onResize: ({ observe, unobserve, width, height, entry }) => {\n      unobserve(); // To stop observing the current target element\n      observe(); // To re-start observing the current target element\n    },\n  });\n\n  const lastestDay = useMemo(() => {\n    const weekDayString = [\n      'อาทิตย์',\n      'จันทร์',\n      'อังคาร',\n      'พุธ',\n      'พฤหัส',\n      'ศุกร์',\n      'เสาร์',\n      'อาทิตย์',\n    ]\n\n    const weekDayColor = [\n      '#C33646',\n      '#D5A21F',\n      '#C55A9A',\n      '#2B9649',\n      '#D5682A',\n      '#31A0C3',\n      '#7E48A4',\n      '#C33646',\n    ]\n\n    const lastEntry = processedData[processedData.length - 1];\n    const dt = DateTime.fromISO(lastEntry?.date);\n    const dayNum = dt.weekday;\n    return {\n      iso: lastEntry?.date,\n      dateStr: toThaiDate(dt),\n      dayColor: weekDayColor[dayNum],\n      weekdayStr: weekDayString[dayNum],\n      weekdayNum: dayNum\n    }\n  }, [processedData]);\n\n  // const smoothedNewCases = useSmoothedSeries(processedData, d => d?.bangkok?.new_cases ?? 0);\n  // const smoothedNewCasesNational = useSmoothedSeries(processedData, d => d?.thailand?.NewConfirmed ?? 0);\n  const bangkokNewCases = useSimplifiedSeries(processedData, d => d?.bangkok?.new_cases ?? 0);\n  const smoothedNewCases = processedData.map(d => ({\n    date: d.date,\n    value: d?.bangkok?.new_cases_7day_average ?? 0\n  }));\n  const nationalNewCases = useSimplifiedSeries(processedData, d => d?.thailand?.NewConfirmed ?? 0);\n  const bangkokNewDeaths = useSimplifiedSeries(processedData, d => d?.bangkok?.new_death ?? 0);\n  // const smoothedNewDeaths = useSmoothedSeries(processedData, d => d?.bangkok?.new_death ?? 0);\n  const smoothedNewDeaths = processedData.map(d => ({\n    date: d.date,\n    value: d?.bangkok?.new_deaths_7day_average ?? 0\n  }));\n\n  const paddedWidth = useMemo(() => width - padding.left - padding.right, [width, padding]);\n  const paddedHeight = useMemo(() => height - padding.top - padding.bottom, [height, padding]);\n\n  const scaleX = useMemo(() => d3.scaleTime()\n    .domain(d3.extent(processedData, d => new Date(d.date)))\n    .range([0, boxWidth - boxPadding * 2 - textBoxWidth - chartPadding.left - chartPadding.right])\n    , [processedData, paddedWidth]);\n\n  const scaleY = useMemo(() => d3.scaleLinear()\n    // .domain([0, d3.max(processedData, d => +d?.thailand?.NewConfirmed ?? 0)])\n    .domain([0, d3.max(processedData, d => +d?.bangkok?.new_cases ?? 0)])\n    .range([\n      boxHeight - 2 * boxPadding - chartPadding.top - chartPadding.bottom,\n      0\n    ])\n    , [processedData, paddedHeight]);\n\n  const scaleYDeaths = useMemo(() => d3.scaleLinear()\n    .domain([0, d3.max(processedData, d => +d?.bangkok?.new_death ?? 0)])\n    .range([\n      deathBoxHeight - 2 * boxPadding - chartPadding.top - chartPadding.bottom,\n      0\n    ])\n    , [processedData, paddedHeight]);\n\n  const downloadPng = () => {\n    console.log(svgRef.current)\n    const scale = 3;\n    const elm = document.getElementById('container');\n    console.log(elm.offsetHeight, elm.offsetWidth)\n    domtoimage.toPng(elm, {\n      height: elm.offsetHeight * scale,\n      width: elm.offsetWidth * scale,\n      style: {\n        transform: `scale(${scale}) translate(${elm.offsetWidth / scale}px, ${elm.offsetHeight / scale}px)`\n      },\n    })\n      .then(function (dataUrl) {\n        var link = document.createElement('a');\n        link.download = `bkkcovid-${lastestDay.iso}.png`;\n        link.href = dataUrl;\n        link.click();\n      })\n      .catch((err) => console.error(err));\n  };\n\n  return (\n    <>\n      <ChartContainer>\n        {/* <SvgContainer ref={observe}> */}\n        <div id=\"container\">\n          <svg\n            id=\"chart\"\n            className=\"d3-component\"\n            width={'100%'}\n            // height={height}\n            ref={svgRef}\n            viewBox={`0 0 ${width} ${height}`}\n            style={{\n              backgroundColor: '#F3E1E3'\n            }}\n          >\n            <text x={pad} y={pad} fontSize={24} dominantBaseline=\"hanging\" fontWeight=\"600\">สถานการณ์ COVID-19 ใน</text>\n            <text x={pad} y={pad + 20} fontSize={39} dominantBaseline=\"hanging\" fontWeight=\"600\">กรุงเทพมหานคร</text>\n\n            <rect x={width - pad - 160} y={pad} width={160} height={64} rx={16} fill={lastestDay.dayColor} />\n            <text x={width - pad - 80} y={pad + 10} dominantBaseline=\"hanging\" textAnchor=\"middle\" fontWeight=\"400\" fontSize={16} class=\"text-white\">ประจำวัน{lastestDay.weekdayStr}ที่</text>\n            <text x={width - pad - 80} y={pad + 28} dominantBaseline=\"hanging\" textAnchor=\"middle\" fontWeight=\"600\" fontSize={24} class=\"text-white\">{lastestDay.dateStr}</text>\n\n            <ChartBlock\n              label=\"ผู้ติดเชื้อยืนยัน\"\n              svgRef={svgRef}\n              x={pad}\n              y={topOffset}\n              boxHeight={boxHeight}\n              boxWidth={boxWidth}\n              padding={chartPadding}\n              scaleY={scaleY}\n              scaleX={scaleX}\n              rawSeries={bangkokNewCases}\n              smoothedSeries={smoothedNewCases}\n              accumulated={processedData?.[processedData.length - 1]?.bangkok?.accumulated_cases}\n              latestValueOutskirt={processedData?.[processedData.length - 1]?.bangkok?.new_cases_outskirt}\n              latestValue={processedData?.[processedData.length - 1]?.bangkok?.new_cases}\n              firstDate={processedData?.[0]?.date}\n              latestDate={processedData?.[processedData?.length - 1]?.date}\n              tickCount={8}\n              fill=\"#C33646\"\n              fillPanel=\"#0002\"\n            // notes=\"ไม่รวมในเรือนจำ\"\n              showDisclaimer={true}\n            />\n            <ChartBlock\n              label=\"ผู้เสียชีวิต\"\n              x={pad}\n              y={topOffset + boxHeight + gutter}\n              boxHeight={deathBoxHeight}\n              boxWidth={boxWidth}\n              padding={chartPadding}\n              scaleY={scaleYDeaths}\n              scaleX={scaleX}\n              rawSeries={bangkokNewDeaths}\n              smoothedSeries={smoothedNewDeaths}\n              accumulated={processedData?.[processedData.length - 1]?.bangkok?.accumulated_death}\n              latestValueOutskirt={processedData?.[processedData.length - 1]?.bangkok?.new_death_outskirt}\n              latestValue={processedData?.[processedData.length - 1]?.bangkok?.new_death}\n              firstDate={processedData?.[0]?.date}\n              latestDate={processedData?.[processedData?.length - 1]?.date}\n              fill=\"#333031\"\n              fillPanel=\"#fff1\"\n            />\n\n            <text x={pad} y={height - pad - 20} dominantBaseline=\"bottom\" fontWeight=\"400\" fontSize={16} fill=\"#222\">*ไม่รวมผู้ติดเชื้อในเรือนจำ / รวบรวมข้อมูลจาก ศบค. และ กทม. </text>\n            <text x={pad} y={height - pad} dominantBaseline=\"bottom\" fontWeight=\"400\" fontSize={16} fill=\"#222\">ติดตามสถานการณ์และและดูไฟล์ข้อมูลได้ที่ taepras.com/bkkcovid</text>\n\n            <g transform={`translate(${width - pad},${height - pad})`}>\n              <g transform={`translate(-54,-32)`}>\n                {/* <image x=\"-54\" y=\"-32\" width=\"54\" height=\"32\" href=\"/bkkcovid/logo_initials.svg\" /> */}\n                <path d=\"M21.9537 20.21C23.8502 22.7782 26.2604 22.9758 27.4457 22.9758C29.9744 22.9758 31.9499 21.988 33.2538 20.7632C34.2416 19.8149 35.9406 17.7208 35.9406 13.8488C35.9406 10.4508 34.6367 8.31716 33.3724 7.05286C31.4363 5.1168 29.0262 4.7612 27.5247 4.7612C24.3638 4.7612 22.7044 6.46019 21.9537 7.52694V5.31435H17.1333V31.4706H21.9537V20.21ZM26.2209 9.02841C27.3667 9.02841 28.6311 9.463 29.5003 10.2532C30.4485 11.162 30.9622 12.5844 30.9622 13.8488C30.9622 15.1131 30.488 16.5355 29.4608 17.4838C28.8286 18.0764 27.8013 18.7086 26.2209 18.7086C24.7195 18.7086 23.6921 18.1159 23.06 17.5627C22.1117 16.733 21.4795 15.4292 21.4795 13.8488C21.4795 12.2683 22.0327 11.083 23.0995 10.1742C23.9687 9.38397 24.9565 9.02841 26.2209 9.02841Z\" fill=\"#222222\" />\n                <path d=\"M14.5573 10.1777V5.35121H9.7309V0.524704H4.90437V5.35121H0.0778656V10.1777H4.90437V19.5089H9.7309V10.1777H14.5573Z\" fill=\"#222222\" />\n                <path d=\"M14.5574 19.5089H9.7309V24.3354H14.5574V19.5089Z\" fill=\"#222222\" />\n                <path d=\"M52.6494 28.5618V23.7323H34.733V28.5618H52.6494Z\" fill=\"#14E1CA\" />\n              </g>\n            </g> \n            \n          </svg>\n        </div>\n        <div style={{ textAlign: 'center', margin: '32px', marginTop: '0px' }}>\n          <div style={{ display: 'flex', justifyContent: 'center', marginBottom: '16px' }}>\n            <div\n              className=\"fb-share-button\"\n              data-href=\"https://taepras.github.io/bkkcovid/\"\n              data-layout=\"button\"\n              data-size=\"large\"\n              style={{ marginRight: '16px' }}\n            >\n              <a\n                target=\"_blank\"\n                href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ftaepras.github.io%bkkcovid%2F&amp;src=sdkpreparse\"\n                className=\"fb-xfbml-parse-ignore\"\n                rel=\"noreferrer\"\n              >\n                Share\n              </a>\n            </div>\n            <a\n              href=\"https://twitter.com/share?ref_src=twsrc%5Etfw\"\n              className=\"twitter-share-button\"\n              data-size=\"large\"\n              data-url=\"https://taepras.github.io/bkkcovid/\"\n              data-via=\"taepras\"\n              data-dnt=\"true\"\n              data-show-count=\"false\"\n            >\n              Tweet\n            </a>\n            <div style={{ marginLeft: '16px', display: 'inline-block' }}>\n              <div\n                className=\"line-it-button\"\n                data-lang=\"en\"\n                data-type=\"share-a\"\n                data-ver=\"3\"\n                data-url=\"https://taepras.github.io/bkkcovid/\"\n                data-color=\"default\"\n                data-size=\"large\"\n                data-count=\"false\"\n              />\n            </div>\n          </div>\n          <div style={{ display: 'flex', marginBottom: '16px' }}>\n            <Button as=\"a\" href=\"#\" onClick={downloadPng} isFullWidth mb style={{ flexGrow: 1, flexBasis: 0, marginRight: '8px' }}>\n              ดาวน์โหลดไฟล์ภาพ\n            </Button>\n            <Button as=\"a\" href=\"https://docs.google.com/spreadsheets/d/1VY6ddD-DdmgIlX_RiFZnIa7ZFXB-mH8nD0hVxaROrP0/edit#gid=0\" target=\"_blank\" isFullWidth mb style={{ flexGrow: 1, flexBasis: 0, marginLeft: '16px' }}>\n              ดูไฟล์ข้อมูล\n            </Button>\n          </div>\n          {/* <pre style={{textAlign:'left'}}>\n            {JSON.stringify(smoothedNewCases, null, 2)}\n          </pre> */}\n          <p style={{ lineHeight: 1.2 }}>\n            <b>อัพเดท 27 มิถุนายน 2564</b><br />\n            **ยอดผู้ติดเชื้อในข้อมูลชุดนี้นี้ น่าจะต่ำกว่าจำนวนผู้ติดเชื้อจริง**<br/>\n            เนื่องจากหลายโรงพยาบาลงดการตรวจ เพราะเตียงรับผู้ป่วยไม่เพียงพอ<br/>\n            <a href=\"https://www.pptvhd36.com/news/%E0%B8%AA%E0%B8%B8%E0%B8%82%E0%B8%A0%E0%B8%B2%E0%B8%9E/145279\" target=\"_blank\">[อ้างอิง]</a>\n          </p>\n          <hr />\n          <p style={{ lineHeight: 1.2 }}>\n            ขอบคุณข้อมูลตัวเลขจาก <a href=\"https://www.facebook.com/informationcovid19\" target=\"_blank\">ศบค.</a> และ <a href=\"http://www.bangkok.go.th/covid19\" target=\"_blank\">กทม.</a>\n            <br />รวบรวมข้อมูลและทำ visualization โดย\n            <br /><a href=\"https://taepras.com\" target=\"_blank\">ธนวิชญ์ ประสงค์พงษ์ชัย (taepras.com)</a>\n            <br />\n            <br />\n            <a href=\"https://taepras.medium.com/%E0%B8%9A%E0%B8%B1%E0%B8%99%E0%B8%97%E0%B8%B6%E0%B8%81%E0%B8%81%E0%B8%B2%E0%B8%A3-%E0%B9%80%E0%B8%A3%E0%B8%B4%E0%B9%88%E0%B8%A1%E0%B8%97%E0%B8%B5%E0%B9%88%E0%B8%95%E0%B8%B1%E0%B8%A7%E0%B9%80%E0%B8%AD%E0%B8%87-%E0%B8%81%E0%B8%B1%E0%B8%9A%E0%B8%81%E0%B8%A3%E0%B8%B2%E0%B8%9F%E0%B9%82%E0%B8%84%E0%B8%A7%E0%B8%B4%E0%B8%94%E0%B9%83%E0%B8%99%E0%B8%81%E0%B8%A3%E0%B8%B8%E0%B8%87%E0%B9%80%E0%B8%97%E0%B8%9E-cbf7d41e2f94\" target=\"_blank\">\n              อ่านที่มาของการทำกราฟนี้ (medium.com)\n            </a>\n            <br />\n            <br />\n            เว็บไซต์นี้เป็น open source หากสนใจนำไปใช้ต่อ<br/>สามารถเข้าไปได้ที่ <a href=\"https://github.com/taepras/bkkcovid\" target=\"_blank\">\n              github.com/taepras/bkkcovid\n            </a>\n          </p>\n        </div>\n        {/* </SvgContainer> */}\n      </ChartContainer>\n    </>\n  );\n}\n\nexport default Chart;\n","import React, { useEffect, useState, useMemo } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\nimport Chart from \"./components/Chart\";\nimport axios from 'axios';\nimport Papa from 'papaparse';\nimport { DateTime } from 'luxon';\nimport styled from 'styled-components';\nimport { toThaiDate } from './utils/toThaiDate';\n\nconst GraphicsContainer = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: flex;\n  flex-direction: column;\n  /* padding: 30px; */\n`\n\nconst Container = styled.div`\n  width: 100%;\n  max-width: 640px;\n  margin: auto;\n`\n\nconst api_url_daily_cases = \"https://covid19.th-stat.com/api/open/timeline\";\nconst gsheets_url = \"https://docs.google.com/spreadsheets/d/e/2PACX-1vR5KEVlTJbefwhG7GXg5swMW1rDSctbXuwZR-omHnxdet_DReCYnu0r_CVgzLTxwPqKlz4WMvKOppv1/pub?gid=0&single=true&output=csv\";\n\nconst convDate = (x) => {\n  return `${x.substr(6, 4)}-${x.substr(0, 2)}-${x.substr(3, 2)}`\n}\n\nfunction App() {\n  const [nationalData, setNationalData] = useState({ Data: [] });\n  const [bangkokData, setBangkokData] = useState();\n\n  const [startDate, setStartDate] = useState(DateTime.now().minus({ months: 2 }).startOf('day'))\n  const [endDate, setEndDate] = useState(DateTime.now().startOf('day'))\n\n  const datesRange = useMemo(() => {\n    const dates = [];\n    let d = startDate;\n    while (d <= endDate) {\n      dates.push(d.toISODate())\n      d = d.plus({ days: 1 });\n    }\n    return dates;\n  }, [startDate, endDate]);\n\n\n  useEffect(() => {\n    // axios.get(api_url_daily_cases).then((res) => {\n    //   console.log(res.data);\n    //   setNationalData(res.data);\n    // });\n\n    axios.get(gsheets_url).then((res) => {\n      const data = Papa.parse(res.data, {\n        header: true,\n        dynamicTyping: true\n      });\n      console.log('gsheets', data);\n      const dt = DateTime.fromISO(data.data[data.data.length - 1].date);\n      setEndDate(dt);\n      setStartDate(dt.minus({ months: 2 }).startOf('day'));\n      setBangkokData(data);\n      // setData(res.data);\n    });\n  }, []);\n\n  const processedData = useMemo(() => {\n    if (!nationalData || !bangkokData)\n      return [];\n\n    const filteredNational = nationalData.Data\n      // .filter(x => {\n      //   const dt = DateTime.fromJSDate(new Date(x.Date));\n      //   return (\n      //     dt >= startDate.startOf('day') &&\n      //     dt <= endDate.endOf('day')\n      //   )\n      // });\n\n    // console.log('bkk', nationalData);\n    // console.log('bkk', bangkokData);\n    const filteredGSheets = bangkokData.data\n      // .filter(x => {\n      //   const dt = DateTime.fromISO(x.date);\n      //   return (\n      //     dt >= startDate.startOf('day') &&\n      //     dt <= endDate.endOf('day')\n      //   )\n      // });\n    // console.log('bkk', filteredGSheets);\n\n    const combined = datesRange.map(date => {\n      return {\n        date: date,\n        thailand: filteredNational?.filter(d => convDate(d.Date) === date)?.[0] ?? {},\n        bangkok: filteredGSheets?.filter(d => d.date === date)?.[0] ?? {}\n      }\n    })\n\n    console.log('gs', filteredGSheets, combined);\n\n    return combined;\n  }, [nationalData, bangkokData, startDate, endDate, datesRange]);\n\n  const showTweetText = useMemo(() => {\n    const urlParams = new URLSearchParams(window.location.search)\n    return urlParams.get('tweettext')\n  });\n\n  return (\n    <div className=\"App\">\n      <Container>\n        {/* <h1>สถานการณ์โควิดใน กทม.</h1> */}\n        <Chart\n          datesRange={datesRange}\n          processedData={processedData} />\n        {showTweetText &&\n          <p style={{ padding: '16px', border: '1px #7F353E solid', borderRadius: '8px' }} id=\"tweet-text\" onClick={() => {\n            navigator.clipboard.writeText(\n              document.getElementById(\"tweet-text\").innerText);\n          }}>\n            ยอดโควิดกรุงเทพวันนี้ ({toThaiDate(processedData?.[processedData?.length - 1]?.date, true)})<br />\n            <br />\n          พบเชื้อ +{processedData?.[processedData?.length - 1]?.bangkok?.new_cases?.toLocaleString?.()} (ปริมณฑล +{processedData?.[processedData?.length - 1]?.bangkok?.new_cases_outskirt?.toLocaleString?.()})<br />\n          เสียชีวิต +{processedData?.[processedData?.length - 1]?.bangkok?.new_death?.toLocaleString?.()} (ปริมณฑล +{processedData?.[processedData?.length - 1]?.bangkok?.new_death_outskirt?.toLocaleString?.()})<br />\n            <br />\n          #กราฟโควิด #โควิดกรุงเทพ<br />\n          ติดตามสถานการณ์ได้ที่ https://taepras.com/bkkcovid<br />\n          รวบรวมข้อมูลจาก ศบค. (@oc_ccsa) และ กทม. (@pr_bangkok)<br />\n          </p>\n        }\n      </Container>\n    </div>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}